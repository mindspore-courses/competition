项目信息
====

## 项目名称

基于MindSpore的NowCastNet模型复现与优化

方案描述
----

本项目面向灾害预警场景下的极端降水短临预测任务，基于雷达观测数据（MRMS美国数据集），在MindSpore深度学习框架下复现并优化NowCastNet模型。项目参考DGMR（Deep Generative Model for Radar）的设计思路，引入判别器模块与对抗训练机制，以提升预测结果的时空一致性与物理逼真度。整体工作涵盖环境搭建、模型重构、训练优化、推理验证及文档交付，目标是在MindSpore框架下实现与原论文相当的预测性能，并适配昇腾910A硬件平台。

* * *

时间规划
----

* **2025年7月1日 – 7月25日**：完成项目需求分析并制定详细的技术方案，解析 NowCastNet 的网络架构、输入输出格式及核心创新点，系统研究 MindSpore 的静态图/动态图机制、自动微分原理、分布式训练策略及昇腾芯片适配方法，重点关注与原框架的语法差异，并邀请专家进行指导。

* **2025年7月26日 – 8月31日**：安装 MindSpore 框架及依赖库，编写环境检查脚本验证 NPU 驱动、框架版本兼容性。封装数据加载模块、日志模块、可视化模块。按原模型模块拆分，使用 MindSpore 的 `nn.Cell` 类重构，重点处理跨框架算子差异。实现数据预处理 pipeline，定义损失函数，配置优化器，编写训练循环。构建推理接口，支持多帧输入的预测输出，实现模型导出，编写推理性能测试脚本。

* **2025年9月1日 – 9月20日**：验证模型精度，分析性能并优化训练过程，主要内容如下：  
  （1）基于大规模气象数据集进行完整训练，记录训练曲线，对比 MindSpore 迁移模型与原框架模型的收敛速度、最终精度差异。在测试集上计算定量指标（MSE、MAE、RMSE），并通过可视化对比进行定性分析，定位精度损失模块。  
  （2）优化数据加载 pipeline，调整分布式策略。重复训练与评估流程，确认精度指标和性能指标达到预期目标。

* **2025年9月21日 – 9月30日**：统一代码风格，补充关键函数注释、模块说明文档，移除冗余代码，确保可维护性。编写技术报告，涵盖复现方案、性能对比、问题解决记录。提交 GitHub 仓库，提供完整 README。

* * *

# 项目进度

## 已完成工作

### 技术调研与方案设计

* 完成 NowCastNet 模型深度调研，系统梳理其网络架构及核心原理；
* 全面学习 MindSpore 框架特性，重点掌握静态图编程范式、自动微分机制及跨框架迁移适配指南，明确模型迁移路线与性能优化方向。

### 开发环境搭建与环境配置

* 搭建基于昇腾 910A 芯片的硬件环境，配置 MindSpore 2.1.0 框架及依赖工具链；
* 编写环境校验脚确保 NPU 驱动、框架版本及算子兼容性；
* 搭建 Git 代码仓库并规范分支管理，完成项目基础框架搭建，包含数据加载、日志、训练与推理接口等模块。

### 模型迁移与开发实现

* 基于 MindSpore 重构 NowCastNet 模型结构，按模块拆分实现输入嵌入层、时空编码器、时序解码器及输出层；
* 解决跨框架算子差异问题，完成训练流程开发，包括 MRMS 雷达回波数据的预处理、损失函数定义、优化器配置；
* 开发推理接口，支持输入过去9帧（90分钟）雷达回波，预测未来20帧（200分钟）降水序列。

### 模型训练与优化

* 基于5年历史雷达数据（10万+样本）完成3轮全量训练；
* 采用混合精度训练、数据加载异步化、动态学习率调度等策略优化训练效率；
* 在4卡 Ascend 910A 上实现分布式训练，验证模型输出格式、预测长度与预期一致。

### 成果整理与交付

* 统一代码风格，补充注释与使用文档；
* 提交完整项目仓库，包含训练/推理脚本、依赖清单（`requirements.txt`）及技术文档。

* * *

## 遇到的问题及解决方案

1. **预训练权重缺失**  
   官方PyTorch权重不完整，无法直接迁移。解决方案：放弃权重迁移，基于公开MRMS数据从零训练，并引入DGMR判别器结构提升生成质量。

2. **MindSpore GRAPH模式与动态逻辑冲突**  
   原始代码中通过Python变量动态修改学习率，在GRAPH模式下无效。解决方案：改用`LearningRateSchedule`接口，将学习率封装为可图编译的Tensor变量。

3. **环境兼容性问题**  
   初期昇腾驱动与MindSpore版本不匹配。解决方案：使用官方推荐镜像重装系统，确保版本对齐，并通过校验脚本持续监控NPU状态。

* * *

## 测试用例与结果验证

* **数据集**：USA_MRMS雷达回波数据，训练:验证:测试 = 7 : 2 : 1
* **输入/输出**：输入9帧（90分钟），预测未来20帧（200分钟），时间分辨率10分钟
* **评估指标（测试集平均）**：
  * MAE：0.7327 mm/h
  * MSE：7.4829 mm²/h²
  * RMSE：2.5074 mm/h

结果表明，复现模型在MindSpore下能有效捕捉降水短临演变特征，预测稳定可靠，具备业务应用潜力。

* * *

## 后续工作安排

1. **扩充数据规模**：新增3年全球多气候区数据（雷达、卫星、地面站），样本量提升至20万+，进行微调训练；
2. **区域泛化性研究**：划分湿润、干旱、复杂地形等典型区域测试集，分析模型适应性；
3. **模型轻量化**：基于MindSpore Lite进行压缩，适配边缘设备；
4. **服务化部署**：开发API接口，支持实时预测结果推送；
