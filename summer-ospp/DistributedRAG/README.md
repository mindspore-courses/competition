# åŸºäº Ray+MindSpore+Milvus å®ç°å¼€ç®±å³ç”¨çš„åˆ†å¸ƒå¼ RAG

[![License](https://img.shields.io/badge/license-Apache%202.0-blue.svg)](LICENSE)
[![Python](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/)
[![Docker](https://img.shields.io/badge/docker-compose-blue.svg)](https://docs.docker.com/compose/)

ä¸€ä¸ªåŸºäºå¾®æœåŠ¡æ¶æ„çš„åˆ†å¸ƒå¼æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ç³»ç»Ÿï¼Œé›†æˆäº† MindSpore æ·±åº¦å­¦ä¹ æ¡†æ¶ã€Milvus å‘é‡æ•°æ®åº“å’Œ Ray åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ï¼Œæä¾›å¼€ç®±å³ç”¨çš„ RAG è§£å†³æ–¹æ¡ˆã€‚

## ğŸš€ é¡¹ç›®ç‰¹è‰²

- **å¾®æœåŠ¡æ¶æ„**: é‡‡ç”¨ Docker Compose ç¼–æ’ï¼ŒæœåŠ¡è§£è€¦ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤
- **å›½äº§åŒ–æ”¯æŒ**: åŸºäºåä¸º MindSpore æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œæ”¯æŒæ˜‡è…¾ AI å¤„ç†å™¨
- **é«˜æ€§èƒ½å‘é‡æ£€ç´¢**: é›†æˆ Milvus å‘é‡æ•°æ®åº“ï¼Œæ”¯æŒå¤§è§„æ¨¡å‘é‡ç›¸ä¼¼æ€§æœç´¢
- **åˆ†å¸ƒå¼è®¡ç®—**: é¢„ç•™ Ray æ¡†æ¶æ”¯æŒï¼Œä¸ºå¤§è§„æ¨¡åˆ†å¸ƒå¼è®¡ç®—åšå‡†å¤‡
- **å¼€ç®±å³ç”¨**: ä¸€é”®å¯åŠ¨ï¼Œæ— éœ€å¤æ‚é…ç½®
- **å¤šæ ¼å¼æ–‡æ¡£æ”¯æŒ**: æ”¯æŒ PDFã€Markdownã€TXT ç­‰å¤šç§æ–‡æ¡£æ ¼å¼

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Main App      â”‚    â”‚  Embedding      â”‚    â”‚   LLM Server    â”‚
â”‚  (Streamlit)    â”‚â—„â”€â”€â–ºâ”‚   Server        â”‚â—„â”€â”€â–ºâ”‚  (MindSpore)    â”‚
â”‚                 â”‚    â”‚  (MindNLP)      â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     MinIO       â”‚    â”‚     Milvus      â”‚    â”‚      etcd       â”‚
â”‚  (å¯¹è±¡å­˜å‚¨)      â”‚    â”‚   (å‘é‡æ•°æ®åº“)    â”‚    â”‚   (å…ƒæ•°æ®å­˜å‚¨)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

- **Main App**: åŸºäº Streamlit çš„ Web ç•Œé¢ï¼Œæä¾›æ–‡æ¡£ä¸Šä¼ å’Œé—®ç­”åŠŸèƒ½
- **Embedding Server**: åŸºäº MindNLP çš„æ–‡æœ¬å‘é‡åŒ–æœåŠ¡
- **LLM Server**: åŸºäº MindSpore çš„å¤§è¯­è¨€æ¨¡å‹æ¨ç†æœåŠ¡
- **Milvus**: é«˜æ€§èƒ½å‘é‡æ•°æ®åº“ï¼Œç”¨äºå­˜å‚¨å’Œæ£€ç´¢æ–‡æ¡£å‘é‡
- **MinIO**: å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œç”¨äºå­˜å‚¨åŸå§‹æ–‡æ¡£
- **etcd**: åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ï¼Œä¸º Milvus æä¾›å…ƒæ•°æ®æœåŠ¡

## ğŸ“‹ ç¯å¢ƒè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Linux (æ¨è Ubuntu 20.04+)
- **Docker**: 20.10+
- **Docker Compose**: 2.0+
- **å†…å­˜**: è‡³å°‘ 8GB RAM (æ¨è 16GB+)
- **å­˜å‚¨**: è‡³å°‘ 10GB å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: éœ€è¦è®¿é—® Hugging Face æ¨¡å‹ä»“åº“

## ğŸ› ï¸ å¿«é€Ÿå¼€å§‹

### ä¸€é”®å¯åŠ¨å®Œæ•´ç¯å¢ƒ

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd DistributedRAG

# 2. ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# 3. ç­‰å¾…æœåŠ¡å¯åŠ¨å®Œæˆï¼ˆé¦–æ¬¡å¯åŠ¨éœ€è¦ä¸‹è½½æ¨¡å‹ï¼Œçº¦5-10åˆ†é’Ÿï¼‰
docker-compose logs -f
```

### è®¿é—®åº”ç”¨

å¯åŠ¨å®Œæˆåï¼Œæ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
- **ä¸»åº”ç”¨ç•Œé¢**: http://localhost:7860
- **MinIO æ§åˆ¶å°**: http://localhost:9001 (ç”¨æˆ·å/å¯†ç : minioadmin/minioadmin)

### å¼€å‘æ¨¡å¼

å¦‚éœ€ä¿®æ”¹ä»£ç ï¼Œç›´æ¥ç¼–è¾‘ä»¥ä¸‹æ–‡ä»¶å³å¯ï¼š
- `main_app/main.py` - ä¸»åº”ç”¨é€»è¾‘
- `embedding_server/app.py` - å‘é‡åŒ–æœåŠ¡
- `llm_server/app.py` - LLMæ¨ç†æœåŠ¡

ä¿®æ”¹åé‡å¯å¯¹åº”æœåŠ¡ï¼š
```bash
# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose restart main_app
docker-compose restart embedding-server
docker-compose restart llm-server
```

### æœåŠ¡ç«¯å£è¯´æ˜

- **7860**: ä¸»åº”ç”¨ (Streamlit)
- **8001**: EmbeddingæœåŠ¡
- **8002**: LLMæœåŠ¡  
- **9000/9001**: MinIOå­˜å‚¨
- **19530**: Milvuså‘é‡æ•°æ®åº“

## ğŸ“– ä½¿ç”¨æŒ‡å—

### æ–‡æ¡£ä¸Šä¼ ä¸å¤„ç†

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:7860
2. åœ¨å·¦ä¾§é¢æ¿ä¸Šä¼ æ–‡æ¡£ï¼ˆæ”¯æŒ PDFã€Markdownã€TXT æ ¼å¼ï¼‰
3. ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†æ–‡æ¡£ï¼š
   - æå–æ–‡æœ¬å†…å®¹
   - åˆ†å—å¤„ç†
   - ç”Ÿæˆå‘é‡åµŒå…¥
   - å­˜å‚¨åˆ° Milvus å‘é‡æ•°æ®åº“

### æ™ºèƒ½é—®ç­”

1. åœ¨å³ä¾§é—®ç­”åŒºåŸŸè¾“å…¥é—®é¢˜
2. ç³»ç»Ÿä¼šï¼š
   - å°†é—®é¢˜è½¬æ¢ä¸ºå‘é‡
   - åœ¨å‘é‡æ•°æ®åº“ä¸­æ£€ç´¢ç›¸å…³æ–‡æ¡£ç‰‡æ®µ
   - ç»“åˆä¸Šä¸‹æ–‡ç”Ÿæˆå›ç­”

### æ”¯æŒçš„æ–‡æ¡£æ ¼å¼

- **PDF**: è‡ªåŠ¨æå–æ–‡æœ¬å†…å®¹
- **Markdown**: è½¬æ¢ä¸ºçº¯æ–‡æœ¬
- **TXT**: ç›´æ¥è¯»å–æ–‡æœ¬å†…å®¹

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

ä¸»è¦é…ç½®åœ¨ `docker-compose.yml` ä¸­ï¼š

```yaml
# æœåŠ¡åœ°å€é…ç½®
EMBEDDING_SERVER_URL: http://embedding-server/embed
LLM_SERVER_URL: http://llm-server/generate

# MinIO é…ç½®
MINIO_HOST: minio:9000
MINIO_ACCESS_KEY: minioadmin
MINIO_SECRET_KEY: minioadmin

# Milvus é…ç½®
MILVUS_HOST: standalone
MILVUS_PORT: 19530
```

### æ¨¡å‹é…ç½®

#### Embedding æ¨¡å‹
- **é»˜è®¤æ¨¡å‹**: `BAAI/bge-base-zh-v1.5`
- **å‘é‡ç»´åº¦**: 768
- **è¯­è¨€**: ä¸­æ–‡ä¼˜åŒ–

#### LLM æ¨¡å‹
- **é»˜è®¤æ¨¡å‹**: `openbmb/MiniCPM-2B-dpo-bf16`

## ğŸ“ é¡¹ç›®ç»“æ„

```
DistributedRAG/
â”œâ”€â”€ docker-compose.yml          # Docker ç¼–æ’é…ç½®
â”œâ”€â”€ main_app/                   # ä¸»åº”ç”¨æœåŠ¡
â”‚   â”œâ”€â”€ main.py                # Streamlit ä¸»ç¨‹åº
â”‚   â”œâ”€â”€ requirements.txt       # Python ä¾èµ–
â”‚   â””â”€â”€ Dockerfile            # Docker é•œåƒé…ç½®
â”œâ”€â”€ embedding_server/           # å‘é‡åŒ–æœåŠ¡
â”‚   â”œâ”€â”€ app.py                # FastAPI æœåŠ¡
â”‚   â”œâ”€â”€ requirements.txt       # Python ä¾èµ–
â”‚   â””â”€â”€ Dockerfile            # Docker é•œåƒé…ç½®
â”œâ”€â”€ llm_server/               # LLM æ¨ç†æœåŠ¡
â”‚   â”œâ”€â”€ app.py                # FastAPI æœåŠ¡
â”‚   â”œâ”€â”€ requirements.txt       # Python ä¾èµ–
â”‚   â””â”€â”€ Dockerfile            # Docker é•œåƒé…ç½®
â”œâ”€â”€ test_data/                # æµ‹è¯•æ•°æ®
â”‚   â””â”€â”€ test.txt              # ç¤ºä¾‹æ–‡æ¡£
â””â”€â”€ volumes/                  # æ•°æ®å·
    â”œâ”€â”€ etcd/                 # etcd æ•°æ®
    â”œâ”€â”€ milvus/               # Milvus æ•°æ®
    â””â”€â”€ minio/                # MinIO æ•°æ®
```

## ğŸ”„ å¼€å‘æ¨¡å¼

### ä»£ç ä¿®æ”¹

é¡¹ç›®é‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œä¸»è¦ä»£ç æ–‡ä»¶ï¼š
- `main_app/main.py` - ä¸»åº”ç”¨é€»è¾‘å’ŒWebç•Œé¢
- `embedding_server/app.py` - æ–‡æœ¬å‘é‡åŒ–æœåŠ¡
- `llm_server/app.py` - å¤§è¯­è¨€æ¨¡å‹æ¨ç†æœåŠ¡

### æœåŠ¡é‡å¯

ä¿®æ”¹ä»£ç åé‡å¯å¯¹åº”æœåŠ¡ï¼š
```bash
# é‡å¯ä¸»åº”ç”¨
docker-compose restart main_app

# é‡å¯å‘é‡åŒ–æœåŠ¡  
docker-compose restart embedding-server

# é‡å¯LLMæœåŠ¡
docker-compose restart llm-server

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f main_app
docker-compose logs -f embedding-server
docker-compose logs -f llm-server
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ Apache 2.0 è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- [MindSpore](https://www.mindspore.cn/) - åä¸ºå¼€æºæ·±åº¦å­¦ä¹ æ¡†æ¶
- [MindNLP](https://github.com/mindspore-lab/mindnlp) - è‡ªç„¶è¯­è¨€å¤„ç†å·¥å…·åŒ…
- [Milvus](https://milvus.io/) - å‘é‡æ•°æ®åº“
- [MinIO](https://min.io/) - å¯¹è±¡å­˜å‚¨æœåŠ¡
- [Streamlit](https://streamlit.io/) - Web åº”ç”¨æ¡†æ¶

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- æäº¤ Issue
- å‘é€é‚®ä»¶è‡³ [your-email@example.com]
---

**æ³¨æ„**: é¦–æ¬¡å¯åŠ¨æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸‹è½½æ¨¡å‹æ–‡ä»¶ï¼Œè¿™å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚