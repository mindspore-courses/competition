# McpMultiTravelPlanner - 基于MCP协议整合多源信息实现多模态动态旅游规划系统

[![Python](https://img.shields.io/badge/python-3.10+-blue.svg)](https://www.python.org/)
[![MindSpore](https://img.shields.io/badge/MindSpore-2.0+-green.svg)](https://www.mindspore.cn/)

## 📖 项目简介

McpMultiTravelPlanner 以 Qwen2-7B 大语言模型为核心推理引擎，通过模型上下文协议（MCP）构建多源信息整合用户偏好、实时交通/天气数据、景点热度、消费成本等多源信息，实现个性化行程生成、动态路线优化及体验模拟。

基于 MCP 工具实时获取的天气、交通等动态数据，通过 PPO（Proximal Policy Optimization）强化学习算法持续迭代路线策略 —— 以 “最小化行程耗时 + 最大化体验效率” 为目标，动态调整景点先后顺序、交通接驳方式（如从公交切换为打车），并输出优化后的路线方案。
由 Qwen2-7B 模型承接优化后的路线框架，结合用户偏好数据（如 “偏好人文景点”“拒绝早起”）和静态信息（如景点开放时间、门票价格），生成自然语言化的详细行程，同时支持根据用户实时反馈（如 “缩短下午行程”）快速迭代方案。
最终，通过用户友好的 Web 界面将生成的行程与动态优化结果可视化，模拟沉浸式旅行体验，实现 “数据整合 - 智能优化 - 个性化输出 - 体验模拟” 的全流程闭环。

### 💡 核心组件

1. **前端界面**：基于 Vue3 的 Web 应用
2. **强化学习**：基于 ppo 算法考虑距离、花费、景点评分优化旅游方案
3. **后端接口**：基于 flask 实现旅游方案生成、对话等接口

## 🚀 快速开始

### 环境要求

- **python**：3.10
- **vue**：3.5.21
- **vite**：7.1.2
- **image**：mindspore_2.4.10-cann_8.0.0-py_3.10-euler_2.10.11-aarch64-snt9
- **mindspore**：2.6.0
- **mindnlp**：0.4.1
- **node.js**：22.19.0

### 安装步骤

1. **克隆项目**
```bash
git clone https://github.com/mindspore-courses/competition.git
cd competition/summer-ospp/McpMultiTravelPlanner
```

2. **准备模型文件**
```bash
pip install huggingface-hub
export HF_ENDPOINT=https://hf-mirror.com
huggingface-cli login

cd llm_service/app
mkdir models
cd models
huggingface-cli download \
  Qwen/Qwen2-7B-Instruct \
  --local-dir ./Qwen2-7B-Instruct \
  --local-dir-use-symlinks False
```

3. **配置环境**
```bash
cd ../../
pip install -r requirements.txt

cd ../TravelVue
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install v22.19.0
nvm use v22.19.0
npm install
```

4. **MCP工具配置**
- 获取指定地点景点列表：利用高德地图的地点检索API， 5000次/月
- 获取指定景点附近的酒店：利用百度地图的地点检索API，100次/天
- 获取小红书上相关的旅游帖子作为参考：在coze中利用小红书插件搭建工作流并使用API
- 获取两地之间的步行/骑行/驾车/公共交通路线：利用百度地图的路径规划API，30000次/天
- 获取指定地区的天气情况：利用百度地图天气API，300000次/天
- 获取指定地点的经纬度（用于路径规划）：利用百度地图地理编码API，5000次/天
- 获取指定地点附近的美食：利用百度地图地点检索服务，通过美食相关关键字进行检索，100次/天

其中，百度地图和高德地图均需要在对应的开发者平台进行注册申请并替换相应的密钥。

获取小红书上相关的旅游帖子在coze中搭建的工作流样式为
![img.png](imgs/img.png)

5. **启动服务**
```bash
npm run dev

cd ../llm_service
python run.py
```

6. **访问应用**
- 打开浏览器访问：`http://localhost:5173/`

7. **规划过程及结果**
- MCP模块会返回精简后的景点、天气、酒店、美食等信息，例如：
```commandline
{'景点': [{'名称': '西双版纳热带花卉园', '地址': '宣慰大道99号', '等级': 'AAAA', '评分': '4.6', '开放时间': '08:00-18:00', '电话': '0691-2135383;12', '类型': '风景名胜;风景名胜;国家级景点'}, {'名称': '曼听御花园景区', '地址': '曼听路35号', '等级': 'AAAA', '评分': '4.7', '开放时间': '08:00-18:00', '电话': '0691-2161451;12', '类型': '风景名胜;风景名胜;国家级景点'}, {'名称': '告庄西双景', '地址': '宣慰大道2号', '等级': 'AAAA', '评分': '4.7', '开放时间': '08:00-22:30', '电话': '0691-2221600;06', '类型': '风景名胜;风景名胜相关;旅游景点'}, {'名称': '湄公河·星光夜市', '地址': '告庄西双十景区(大金塔寺南侧)', '等级': '未知', '评分': '4.5', '电话': '0691-2221600', '类型': '餐饮服务;餐饮相关场所;餐饮相关'}, {'名称': '景洪市泼水广场', '地址': '景兰一巷与景兰五巷交叉口东100米', '评分': '4.6', '开放时间': '09:00-22:30', '电话': '0691-2588839', '类型': '风景名胜;公园广场;城市广场'}, {'名称': '西双版纳州民族风情园', '地址': '民航路41号', '评分': '4.3', '开放时间': '08:00-18:00', '类型': '风景名胜;公园广场;公园'}, {'名称': '白象沙滩', '地址': '允景洪街道观澜大道与滨江大道交叉口东320米', '评分': '4.4', '类型': '风景名胜;风景名胜;海滩'}, {'名称': '西双版纳野生动物园', '地址': '民航路41号', '评分': '4.5', '开放时间': '09:00-18:00', '类型': '风景名胜;公园广场;动物园'}], '天气': {'当前天气': '晴', '温度': '27°C', '体感温度': '28°C', '湿度': '56%', '风速': '2级 东南风', '未来预报': [{'日期': '2025-10-26', '白天': '多云', '夜间': '多云', '温度': '19~28°C'}, {'日期': '2025-10-27', '白天': '多云', '夜间': '阴', '温度': '19~29°C'}, {'日期': '2025-10-28', '白天': '多云', '夜间': '多云', '温度': '19~29°C'}]}, '酒店': [{'名称': '汉庭酒店(西双版纳孔雀湖店)', '地址': '云南省西双版纳傣族自治州景洪市允景洪街道民航路与勐泐大道交叉口东南侧约152米', '等级': '经济型', '评分': '4.9', '电话': '(0691)2139198'}, {'名称': '景洪悦鸿假日酒店', '地址': '勐龙路1号', '等级': '经济型', '评分': '3.8', '电话': '(0691)2522988'}, {'名称': '西双版纳万福宾馆', '地址': '云南省西双版纳傣族自治州景洪市勐泐大道24号', '评分': '4.2', '电话': '15388806976'}, {'名称': '西双版纳美度大酒店(傣乡水城店)', '地址': '傣乡水城17栋', '等级': '高档型', '评分': '4.6', '电话': '(0691)2768888,1'}, {'名称': '和美酒店', '地址': '俊都五金建材家具城33栋', '等级': '舒适型', '评分': '4.7', '电话': '0691-2139166'}, {'名称': '西双版纳景粮宾馆', '地址': '云南省西双版纳傣族自治州景洪市勐泐大道20号', '等级': '经济型', '评分': '3.9', '电话': '(0691)2123476'}, {'名称': '喆家国际酒店(西双版纳财富中心店)', '地址': '景德路财富中心一层', '等级': '舒适型', '评分': '4.2', '电话': '(0691)2165868'}, {'名称': '西双版纳热土酒店(民族风情园店)', '地址': '民航路39号', '等级': '经济型', '评分': '4.6', '电话': '(0691)8991177'}, {'名称': '西双版纳卡萨青年旅舍', '地址': '西双版纳傣族自治州景洪市嘎兰中路6号', '等级': '经济型', '评分': '4.4', '电话': '15709550080,186'}, {'名称': '西双版纳华峰宾馆', '地址': '景洪北路', '等级': '经济型', '评分': '2.3', '电话': '13657474518'}], '美食': [{'名称': 'mamalao老挝烤肉糯米饭', '地址': '庄洪路12号', '电话': '18388109553'}, {'名称': '老普人家', '地址': '白象巷俊都建材市场33栋104号', '电话': '13759003332'}, {'名称': '整糯坝人家', '地址': '清泉路合顺景苑西北侧', '电话': '13908814158'}, {'名称': '路边摊傣味烧烤', '地址': '俊都建材市场C区26-14室', '电话': '13035973885'}, {'名称': '玉波早点店', '地址': '嘎兰中路92号', '电话': '13759260332'}, {'名称': '龙婷烤串小吃店', '地址': '白象巷7号(白象巷与龙掌路交叉口东北60米)', '电话': '13988115702,159'}, {'名称': '双玉傣家风味楼', '地址': '江北街道景亮路曼阁村寺庙旁(江北派出所、金三角航运公司、118连锁酒店)', '电话': '13887927838'}, {'名称': '缅丽·缅甸小吃(版纳店)', '地址': '宣慰大道沙湾国际商业广场C幢93-94号', '电话': '17708810270'}]}
```
- 未进行强化学习前模型随意进行景点、游玩顺序的规划，强化学习考虑景点间距离、花费、景点评分等信息进行路线规划，显著减低了游玩交通总距离、提升游玩景点质量。
- Qwen2-7B结合强化学习的结果和MCP工具返回的相关信息进行旅游景点规划，并且给出景点图片、住宿、美食、景点间交通方式建议。

## 🔧 开发指南

### 项目结构

```
─McpMultiTravelPlanner
│  ├─imgs                   # 测试结果等相关图片
│  ├─llm_service            # 后端应用
│  │  │  requirements.txt   # Python依赖包列表
│  │  │  run.py             # 应用启动入口
│  │  └─app                 # 应用主目录
│  │      │  config.py      # 应用配置
│  │      │  routes.py      # 接口路由
│  │      ├─models          # 存放大语言模型
│  │      ├─ppo
│  │      │      flexible_tourist_model.zip     # 训练好的PPO模型权重
│  │      │      get_ans.py                     # 获取PPO结果
│  │      │      touristAttractions.py          # PPO算法
│  │      └─utils                               # 工具
│  │              McpTool.py                    # MCP工具
│  │              sample_tool.py                # 常用工具
│  │              weather_district_id.xlsx      # 天气API地区ID映射表
│  ├─ppo
│  │      test.py                    # 算法测试
│  │      touristAttractions.py      # PPO算法
│  │      train.py                   # 算法训练
│  └─TravelVue              # 前端VUE应用
│      ├─public             # 静态资源
│      └─src                # 源代码
│          ├─api            # 后端API调用封装
│          ├─assets         # 样式表
│          ├─components     # Vue组件
│          ├─router         # 路由配置
│          ├─utils          # 工具函数
│          └─views          # 页面组件
```


## 🙏 致谢

- [MindSpore](https://www.mindspore.cn/) - 深度学习框架
- [Qwen2-7B-Instruct](https://huggingface.co/Qwen/Qwen2-7B-Instruct) - 大语言模型
- [Vue3](https://huggingface.co/Qwen/Qwen2-7B-Instruct) - Web 应用框架
- [Flask](https://github.com/pallets/flask) - 后端应用框架
